<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>GifTastic</title>
    <style type="text/css">
        button,
        div,
        form,
        input {
            margin: 10px;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Giphy Search</h1>

        <div id="buttons-view"></div>

        <form id="animal-form">
            <label for="animal-input">Add an animal here!</label>
            <input type="text" id="animal-input"><br>

            <input id="add-animal" type="submit" value="Submit">
        </form>

        <div id="gifs-appear-here">
        </div>


        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script type="text/javascript">

            var animals = ["Dog", "Cat", "Horse", "Elephant", "Bird", "Giraffe", "Hippopotamus", "Mouse", "Bald Eagle", "Kingfisher", "Wale", "Goat"];

            function renderButtons() {
                $("#buttons-view").empty();
                for (var i = 0; i < animals.length; i++) {
                    // create button
                    var button = $("<button>");

                    // configure button
                    button.addClass("animal");
                    button.attr("data-name", animals[i]);
                    button.text(animals[i]);
                    button.on("click", onButtonClick);

                    // append button
                    $("#buttons-view").append(button);
                }
            }

            function onAddClick(event) {
                event.preventDefault();
                var animal = $("#animal-input").val().trim();
                animals.push(animal);
                renderButtons();
            }

            function onButtonClick() {
                var animalName = $(this).attr("data-name");
                var queryURL = "https://api.giphy.com/v1/gifs/search?api_key=nszZeqxRcLsM5LUlyDmT0cuf5lvaWkrQ&q=" +
                    animalName + "&limit=10";
                $.ajax({
                    url: queryURL,
                    method: "GET"
                })
                    .then(function (response) {
                        let results = response.data;
                        for (let i = 0; i < results.length; i++) {
                            let gifDiv = $("<div>");
                            let rating = results[i].rating;
                            let p = $("<p>").text("Rating: " + rating);

                            // create image
                            let animalImage = $("<img>");
                            let flag = 0;
                            // configure image
                            animalImage.addClass("gif");
                            animalImage.attr("src", results[i].images.fixed_height.url);
                            animalImage.on("click", function (){
                                console.log(flag);
                                if (flag == 0) {
                                    flag = 1;
                                    animalImage.attr("src", results[i].images.fixed_height_still.url);
                                    console.log("one", flag);
                                } else if (flag == 1) {
                                    flag = 0;
                                    animalImage.attr("src", results[i].images.fixed_height.url);
                                    console.log("zero", flag);
                                }
                            }); 
                            
                            // add to DOM
                            gifDiv.append(p);
                            gifDiv.append(animalImage);
                            $("#gifs-appear-here").prepend(gifDiv);
                        }
                    });
            }

            $(document).ready(function () {
                console.log('document ready');
                // var flag = 0;
                $(".gif").click(function () {
                    console.log('clicked');
                //     if (flag == 0) {
                //         $("#img").attr("src", results[i].images.fixed_height.url);
                //         flag = 1;
                //     } else if (flag == 1) {
                //         $("#img").attr("src", fixed_height_still.url);
                //         flag = 0;
                //     }
                });
            });


            function main() {
                renderButtons();
                $("#add-animal").on("click", onAddClick);
            }

            main();

        </script>
    </div>
</body>

</html>